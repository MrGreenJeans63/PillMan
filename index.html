

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Pill Man — Meal Anchored</title>
<link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@100;300;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#0b0f14"/>
<style>
  :root{
    --bg:#0b0f14; --fg:#e5f0ff; --muted:#8aa0b3;
    --ok:#4ce07a; --warn:#ffb74d; --bad:#ff4d4d;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
    display:flex;justify-content:center;align-items:center;
    -webkit-font-smoothing:antialiased;}
  .wrap{width:min(92vw,480px);display:flex;flex-direction:column;align-items:center;text-align:center;gap:14px;}
  .decision{display:flex;flex-direction:column;align-items:center;gap:8px;}
  .decision .answer{font-family:'Inter Tight',system-ui,sans-serif;font-weight:100;
    font-size:clamp(60px,18vw,100px);}
  .decision .label{font-size:12px;letter-spacing:.5px;color:var(--muted);}
  .timepair{display:flex;flex-direction:column;align-items:center;}
  .timepair .time{font-family:'Inter Tight',system-ui,sans-serif;font-weight:100;
    font-size:clamp(42px,12vw,72px);}
  .status{font-size:15px;}
  .ok{color:var(--ok);} .warn{color:var(--warn);} .bad{color:var(--bad);}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px;}
  button{height:46px;border:none;border-radius:8px;font-family:'Inter Tight',system-ui;
    font-weight:100;font-size:15px;cursor:pointer;color:var(--bg);}
  #btn_pill{background:var(--warn);} #btn_meal{background:var(--bad);}
  #btn_edit_pill{background:#666;color:#fff;} #btn_edit_meal{background:#666;color:#fff;}
</style>
</head>
<body>
<div class="wrap">
  <div class="decision">
    <div class="answer" id="can_pill">—</div>
    <div class="label" id="decision_label">CAN I TAKE A PILL NOW?</div>
  </div>
  <div class="timepair">
    <div class="time" id="safe_time">—</div>
    <div class="label" id="safe_label">SAFE / EAT AGAIN AT</div>
  </div>
  <div class="status" id="status">Log a meal to begin.</div>
  <div class="controls">
    <button id="btn_meal">LOG MEAL</button>
    <button id="btn_pill">LOG PILL</button>
    <button id="btn_edit_meal">EDIT MEAL</button>
    <button id="btn_edit_pill">EDIT PILL</button>
  </div>
</div>

<script>
const H = 3600e3;
const $ = id => document.getElementById(id);
const two = n=>String(n).padStart(2,'0');
const showClock = ts => {
  if(!ts) return '—';
  const d=new Date(ts); let h=d.getHours(),m=d.getMinutes(),ap=h>=12?'PM':'AM'; h=h%12||12;
  return `${h}:${two(m)} ${ap}`;
};
const nowTS=()=>Date.now();
let LAST_MEAL_TS=null, LAST_PILL_TS=null;

function plan(){
  const now=nowTS();
  if(!LAST_MEAL_TS) return { state:'none', msg:'Log a meal to begin.' };
  const sinceMeal=(now-LAST_MEAL_TS)/H;
  const eatAfter=LAST_MEAL_TS+2*H;
  const safeAfter=eatAfter;
  const eatAgain=(LAST_PILL_TS)?LAST_PILL_TS+1*H:null;
  let state='ok', msg='';
  // logic
  if(sinceMeal<2){ state='bad'; msg=`Too soon after meal • Safe at ${showClock(safeAfter)}`; }
  else if(LAST_PILL_TS && now < (LAST_PILL_TS + 1*H)){ state='bad'; msg=`Post-pill lock • Eat again at ${showClock(eatAgain)}`; }
  else{ state='ok'; msg='Safe to take pill'; }
  return {state,msg,safeAfter,eatAgain};
}

function render(){
  const r=plan();
  const ans=$('can_pill'), safe=$('safe_time'), status=$('status');
  if(r.state==='none'){ ans.textContent='—'; safe.textContent='—'; status.textContent=r.msg; return; }
  ans.textContent=(r.state==='ok')?'YES':'NO';
  ans.className='answer '+r.state;
  if(r.state==='ok'){
    safe.textContent=showClock(nowTS()+1*H);
    $('safe_label').textContent='EAT AGAIN AT';
  }else{
    safe.textContent=(r.state==='bad' && r.safeAfter)?showClock(r.safeAfter):'—';
    $('safe_label').textContent='SAFE AT';
  }
  status.textContent=r.msg;
}

function parseClockInput(t){ if(!t) return null; const s=String(t).trim(); const d=new Date();
  if(s.includes(':')){const[Hh,Mm='0']=s.split(':'); d.setHours(+Hh,+Mm,0,0); return d.getTime();}
  const hh=+s;if(isNaN(hh))return null; d.setHours(hh,0,0,0); return d.getTime();
}

function wire(){
  $('btn_meal').onclick=()=>{LAST_MEAL_TS=nowTS();render();};
  $('btn_pill').onclick=()=>{LAST_PILL_TS=nowTS();render();};
  $('btn_edit_meal').onclick=()=>{const inp=prompt('Last meal (HH or HH:MM)?');const ts=parseClockInput(inp);if(ts){LAST_MEAL_TS=ts;render();}};
  $('btn_edit_pill').onclick=()=>{const inp=prompt('Last pill (HH or HH:MM)?');const ts=parseClockInput(inp);if(ts){LAST_PILL_TS=ts;render();}};
}

document.addEventListener('DOMContentLoaded',()=>{wire();render();setInterval(render,15000);});
</script>
</body>
</html>
